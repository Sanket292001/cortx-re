apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "elastic-project.init-setup-job" . }}
  namespace: {{ include "elastic-project.tools.namespace" . }}
  labels: {{ include "elastic-project.labels" . | nindent 4 }}
data:
  configure.sh: |-
    #! /bin/bash

    # Section Displaying Functions
    displaySection() {
      echo "\n\n"
      echo "---------------------------------------"
      echo "\t$1"
      echo "---------------------------------------"
      echo "\n"
    }

    # Installation Seciton
    displaySection "Update APK and Install Packages"

    apk update && apk add curl jq

    # Setting Kibana Dashboard
    displaySection "Setting up Kibana Dashboard"

    curl https://api.github.com/repos/Sanket292001/cortx-re/contents/solutions/dashboard/build/kibana/KibanaDashboard.ndjson?ref=dashboard | jq -r ".content" | base64 -d > KibanaDashboard.ndjson

    curl -u "$ELASTICSEARCH_USERNAME:$ELASTICSEARCH_PASSWORD" --request POST 'http://dashboard-kibana-kb-http.elastic.svc:5601/api/saved_objects/_import?overwrite=true' \
    --header 'kbn-xsrf: true' \
    --form 'file=@"KibanaDashboard.ndjson"'
